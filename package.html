<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل عرض السفر</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Tajawal', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">تفاصيل عرض السفر</h1>
            <div class="flex gap-4">
                <a href="history.html" class="text-blue-500 hover:underline">العودة إلى السجل</a>
                <button id="download-btn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">تحميل HTML</button>
            </div>
        </div>
        <div id="package-details" class="bg-white rounded-lg shadow-lg">
            <!-- Package details will be loaded here dynamically -->
            <p class="p-8">يتم تحميل تفاصيل الباقة...</p>
        </div>
    </div>

    <script>
        const packageDetailsContainer = document.getElementById('package-details');
        const downloadBtn = document.getElementById('download-btn');

        const urlParams = new URLSearchParams(window.location.search);
        const packageId = urlParams.get('id');

        const history = JSON.parse(localStorage.getItem('tourism_package_history')) || [];
        const pkg = history.find(p => p.id == packageId);

        if (pkg) {
            const formData = pkg.formData;
            const generateHTML = () => {
            return `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>برنامج خاص ل${formData.clientName} ل${formData.destination}</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background-color: #f5f7fa; color: #333; line-height: 1.6; }
        .poster-container { width: 720px; min-height: 1334px; margin: 0 auto; background: linear-gradient(135deg, #f8f5ff 0%, #f5f7fa 100%); position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .bg-shape { position: absolute; border-radius: 50%; opacity: 0.1; z-index: 0; }
        .shape-1 { width: 400px; height: 400px; background: linear-gradient(45deg, #6191fe, #8c71f3); top: -100px; left: -100px; }
        .shape-2 { width: 300px; height: 300px; background: linear-gradient(45deg, #8c71f3, #f38981); bottom: -50px; right: -50px; }
        .content { position: relative; z-index: 1; padding: 40px; }
        .header { text-align: center; margin-bottom: 30px; position: relative; height: 280px; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); }
        .header-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; }
        .header-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.3); z-index: 0; }
        .header-content { position: relative; z-index: 1; padding: 40px 20px; color: white; text-align: center; }
        .header-content h1, .header-content h2, .header-content h3 {
            color: white;
        }
        .title { font-size: 36px; font-weight: 700; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); }
        .subtitle { font-size: 22px; font-weight: 500; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); }
        .section { background: white; border-radius: 16px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .section-title { font-size: 24px; font-weight: 700; color: #6191fe; margin-bottom: 15px; display: flex; align-items: center; }
        .section-title .material-icons { margin-left: 10px; color: #6191fe; }
        .flight-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: #f8f5ff; border-radius: 12px; overflow: hidden; }
        .flight-table th { background: #6191fe; color: white; padding: 12px 15px; text-align: right; font-weight: 600; }
        .flight-table td { padding: 12px 15px; border-bottom: 1px solid #f8f5ff; text-align: right; }
        .flight-direction { font-weight: 600; color: #6191fe; display: flex; align-items: center; }
        .airline-logo { height: 30px; vertical-align: middle; margin-left: 8px; }
        .hotel-card {
            background: #f8f5ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .hotel-card-image {
            width: 150px;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
        }
        .hotel-card-details {
            flex: 1;
        }
        .hotel-card-name {
            font-size: 20px;
            font-weight: 700;
            color: #6191fe;
            margin-bottom: 10px;
        }
        .hotel-card-info {
            font-size: 15px;
            color: #555;
            margin-bottom: 5px;
        }
        .itinerary-day { background: #f8f5ff; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-right: 4px solid #6191fe; }
        .day-header { display: flex; align-items: center; margin-bottom: 10px; }
        .day-number { font-size: 20px; font-weight: 700; color: #6191fe; margin-left: 10px; }
        .day-title { font-size: 18px; font-weight: 600; color: #333; }
        .day-content { display: flex; gap: 20px; align-items: flex-start; }
        .day-text { flex: 1; }
        .day-activities { font-size: 15px; color: #555; line-height: 1.8; padding-right: 15px; }
        .day-image { width: 200px; height: 150px; border-radius: 12px; object-fit: cover; border: 3px solid #6191fe; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .includes-excludes { display: flex; gap: 20px; margin-top: 15px; }
        .includes, .excludes { flex: 1; background: #f8f5ff; border-radius: 12px; padding: 15px; }
        .includes-title, .excludes-title { font-size: 18px; font-weight: 600; color: #6191fe; margin-bottom: 10px; display: flex; align-items: center; }
        .includes-list, .excludes-list { list-style: none; }
        .includes-list li, .excludes-list li { margin-bottom: 8px; padding-right: 20px; position: relative; font-size: 14px; }
        .includes-list li:before { content: "✓"; position: absolute; right: 0; color: #4caf50; font-weight: bold; }
        .excludes-list li:before { content: "✗"; position: absolute; right: 0; color: #f44336; font-weight: bold; }
        .brand-section { display: flex; align-items: center; justify-content: center; margin-bottom: 30px; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .brand-logo { height: 80px; margin-left: 20px; }
        .brand-name { font-size: 28px; font-weight: 700; color: #6191fe; margin-bottom: 5px; }
        .brand-tagline { font-size: 18px; color: #f38981; }
        .cost-breakdown { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .cost-item { text-align: center; padding: 15px; border-radius: 12px; background: #f8f5ff; flex: 1; margin: 0 5px; }
        .cost-value { font-size: 22px; font-weight: 700; color: #6191fe; margin-bottom: 5px; }
        .highlight { color: #6191fe; font-weight: 600; }
        .section-divider { text-align: center; margin: 30px 0; }
        .section-divider img { width: 100%; max-width: 640px; height: auto; }
        .payment-methods { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0; }
        .payment-method { background: #f8f5ff; padding: 12px 15px; border-radius: 10px; display: flex; align-items: center; font-weight: 500; border: 2px solid transparent; transition: all 0.3s; }
        .payment-method:hover { border-color: #6191fe; background: white; }
        .payment-method .material-icons { margin-left: 10px; color: #6191fe; font-size: 22px; }
        .bank-details { margin-top: 25px; }
        .bank-item { background: linear-gradient(135deg, #f8f5ff 0%, #fff 100%); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e8e4ff; }
        .bank-name { font-size: 18px; font-weight: 700; color: #6191fe; margin-bottom: 12px; display: flex; align-items: center; }
        .bank-name .material-icons { margin-left: 8px; font-size: 22px; }
        .account-info, .beneficiary { font-size: 15px; color: #555; margin-bottom: 8px; display: flex; align-items: center; }
        .account-info .material-icons, .beneficiary .material-icons { margin-left: 8px; font-size: 18px; color: #8c71f3; }
        .terms { margin-top: 15px; }
        .terms-item { background: #f8f5ff; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-right: 4px solid #6191fe; font-size: 15px; line-height: 1.6; }
        .footer { text-align: center; padding: 25px; background: linear-gradient(135deg, #6191fe 0%, #8c71f3 100%); color: white; border-radius: 16px; font-size: 16px; line-height: 1.8; margin-top: 30px; }
        .footer a { color: white; text-decoration: none; font-weight: 600; border-bottom: 2px solid white; }
    </style>
</head>
<body>
    <div class="poster-container">
        <div class="bg-shape shape-1"></div>
        <div class="bg-shape shape-2"></div>
        <div class="content">
            <div class="brand-section">
                <img src="https://z-cdn-media.chatglm.cn/files/25b78501-45f1-426e-ad8f-20b0a946a70e_pasted_image_1759241618713.png?auth_key=1790777630-7dfed01e625a42d2925124a4eed16209-0-c43c12c0cf0a7986d35ede5c427fb543" class="brand-logo">
                <div>
                    <div class="brand-name">اطلالة للسفر والسياحة</div>
                    <div class="brand-tagline">Travel & Tourism</div>
                </div>
            </div>
            
            <div class="header">
                <img src="${formData.headerImage}" class="header-bg">
                <div class="header-content">
                    <h1 class="title">برنامج خاص ل${formData.clientName} ل${formData.destination}</h1>
                    <h2 class="subtitle">${formData.cities}</h2>
                    <h3 class="subtitle">${formData.phoneNumber} | البالغين: ${formData.adults} | الأطفال: ${formData.children}</h3>
                </div>
            </div>
            
            ${formData.flightsEnabled ? `
            <div class="section">
                <h3 class="section-title"><i class="material-icons">flight</i> معلومات الطيران</h3>
                <table class="flight-table">
                    <thead>
                        <tr>
                            <th>معلومات الرحلة</th>
                            <th>شركة الطيران</th>
                            <th>مطار الاقلاع - الوقت</th>
                            <th>مطار الوصول - الوقت</th>
                            <th>مدة التوقف</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${formData.outboundFlights.map(flight => `
                        <tr>
                            <td><div class="flight-direction"><i class="material-icons">flight_takeoff</i> رحلة الذهاب</div><div>${flight.date}</div></td>
                            <td>${flight.airline}<br><img src="${flight.airlineLogo}" class="airline-logo"></td>
                            <td>${flight.departureAirport}<br>${flight.departureTime}</td>
                            <td>${flight.arrivalAirport}<br>${flight.arrivalTime}</td>
                            <td>${flight.stopover}</td>
                        </tr>
                        `).join('')}
                        ${formData.returnFlights.map(flight => `
                        <tr>
                            <td><div class="flight-direction"><i class="material-icons">flight_land</i> رحلة الإياب</div><div>${flight.date}</div></td>
                            <td>${flight.airline}<br><img src="${flight.airlineLogo}" class="airline-logo"></td>
                            <td>${flight.departureAirport}<br>${flight.departureTime}</td>
                            <td>${flight.arrivalAirport}<br>${flight.arrivalTime}</td>
                            <td>${flight.stopover}</td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            ` : ''}
            
            ${formData.hotelsEnabled ? `
            <div class="section-divider">
                <img src="https://z-cdn-media.chatglm.cn/files/3f0b9cd4-570e-4ebd-8aff-d14b29404d65_pasted_image_1759242842896.png?auth_key=1790778881-ff8d15077da24bdaa583c77bdfed7461-0-a6a4b77eb709f2fa9cfa5d2fb50cc028" alt="Section Divider">
            </div>
            
            <div class="section">
                <h3 class="section-title"><i class="material-icons">hotel</i> الإقامة الفندقية</h3>
                ${formData.hotels.map(hotel => `
                <div class="hotel-card">
                    <img src="${hotel.imageUrl}" class="hotel-card-image">
                    <div class="hotel-card-details">
                        <div class="hotel-card-name"><a href="${hotel.link}" target="_blank" class="hover:underline">${hotel.name}</a></div>
                        <div class="hotel-card-info"><strong>تاريخ الدخول:</strong> ${hotel.checkIn}</div>
                        <div class="hotel-card-info"><strong>تاريخ الخروج:</strong> ${hotel.checkOut}</div>
                        <div class="hotel-card-info"><strong>عدد الليالي:</strong> ${hotel.nights}</div>
                        <div class="hotel-card-info"><strong>نوع الغرفة:</strong> ${hotel.roomType}</div>
                        <div class="hotel-card-info"><strong>الخدمات:</strong> ${hotel.services}</div>
                    </div>
                </div>
                `).join('')}
            </div>
            ` : ''}
            
            ${formData.dailyItineraryEnabled && formData.dailyItinerary.length > 0 ? `
            <div class="section-divider">
                <img src="https://z-cdn-media.chatglm.cn/files/3f0b9cd4-570e-4ebd-8aff-d14b29404d65_pasted_image_1759242842896.png?auth_key=1790778881-ff8d15077da24bdaa583c77bdfed7461-0-a6a4b77eb709f2fa9cfa5d2fb50cc028" alt="Section Divider">
            </div>
            
            <div class="section">
                <h3 class="section-title"><i class="material-icons">map</i> البرنامج السياحي اليومي ل${formData.clientName}</h3>
                ${formData.dailyItinerary.map(day => `
                <div class="itinerary-day">
                    <div class="day-header">
                        <i class="material-icons" style="color: #6191fe;">event</i>
                        <span class="day-number">${day.dayNumber}</span>
                        <span style="color: #999; margin: 0 5px;">•</span>
                        <span class="day-title">${day.title}</span>
                    </div>
                    <div class="day-content">
                        <div class="day-text">
                            <div class="day-activities">${day.activities}</div>
                        </div>
                        ${day.imageUrl ? `<img src="${day.imageUrl}" alt="${day.dayNumber}" class="day-image">` : ''}
                    </div>
                </div>
                `).join('')}
            </div>
            ` : ''}
            
            ${formData.carRentalEnabled ? `
            <div class="section-divider">
                <img src="https://z-cdn-media.chatglm.cn/files/3f0b9cd4-570e-4ebd-8aff-d14b29404d65_pasted_image_1759242842896.png?auth_key=1790778881-ff8d15077da24bdaa583c77bdfed7461-0-a6a4b77eb709f2fa9cfa5d2fb50cc028" alt="Section Divider">
            </div>
            
            <div class="section">
                <h3 class="section-title"><i class="material-icons">directions_car</i> استئجار سيارة خاصة</h3>
                <div style="display: flex; gap: 30px;">
                    ${formData.carRental.carImage ? `<img src="${formData.carRental.carImage}" style="width: 250px; height: 180px; object-fit: cover; border-radius: 12px;">` : ''}
                    <div style="flex: 1; background: #f8f5ff; border-radius: 12px; padding: 20px;">
                        <div><strong>تاريخ الاستلام:</strong> ${formData.carRental.pickupDate}</div>
                        <div><strong>تاريخ التسليم:</strong> ${formData.carRental.returnDate}</div>
                        <div><strong>مكان الاستلام:</strong> ${formData.carRental.pickupLocation}</div>
                        <div><strong>مكان التسليم:</strong> ${formData.carRental.returnLocation}</div>
                        <div><strong>نوع السيارة:</strong> ${formData.carRental.carType}</div>
                    </div>
                </div>
            </div>
            ` : ''}
            
            <div class="section-divider">
                <img src="https://z-cdn-media.chatglm.cn/files/3f0b9cd4-570e-4ebd-8aff-d14b29404d65_pasted_image_1759242842896.png?auth_key=1790778881-ff8d15077da24bdaa583c77bdfed7461-0-a6a4b77eb709f2fa9cfa5d2fb50cc028" alt="Section Divider">
            </div>

            <div class="section">
                <h3 class="section-title"><i class="material-icons">checklist</i> الباقة تشمل/لا تشمل</h3>
                <div class="includes-excludes">
                    <div class="includes">
                        <div class="includes-title"><i class="material-icons">check_circle</i> الباقة تشمل</div>
                        <ul class="includes-list">${formData.includes.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>
                    <div class="excludes">
                        <div class="excludes-title"><i class="material-icons">cancel</i> الباقة لا تشمل</div>
                        <ul class="excludes-list">${formData.excludes.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title"><i class="material-icons">payments</i> تفاصيل التكلفة</h3>
                <div class="cost-breakdown">
                    <div class="cost-item"><div class="cost-value">${formData.totalCost}</div><div>إجمالي تكلفة العرض</div></div>
                    <div class="cost-item"><div class="cost-value">${formData.discount}</div><div>${formData.discountNote}</div></div>
                </div>
                <div style="text-align: center; margin-top: 15px; font-size: 16px;">
                    منسق العرض: <span class="highlight">${formData.coordinator}</span>، ${formData.coordinatorTitle}
                </div>
                <div style="text-align: center; margin-top: 15px; font-size: 14px; color: #666;">
                    <i class="material-icons" style="font-size: 16px; color: #8c71f3; vertical-align: middle; margin-left: 5px;">info</i>
                    الامكانيات والاسعار غير ثابتين لحين تاكيد الحجز
                </div>
            </div>

            <div class="section-divider">
                <img src="https://z-cdn-media.chatglm.cn/files/3f0b9cd4-570e-4ebd-8aff-d14b29404d65_pasted_image_1759242842896.png?auth_key=1790778881-ff8d15077da24bdaa583c77bdfed7461-0-a6a4b77eb709f2fa9cfa5d2fb50cc028" alt="Section Divider">
            </div>

            <div class="section">
                <h3 class="section-title"><i class="material-icons">account_balance</i> طرق الدفع</h3>
                
                <div>تتيح شركة اطلاله للسفر والسياحة إمكانية الدفع عن طريق:</div>
                
                <div class="payment-methods">
                    <div class="payment-method">
                        <i class="material-icons">account_balance</i>
                        بنك الراجحي
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">account_balance</i>
                        بنك ساب
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">account_balance</i>
                        البنك الأهلي السعودي
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">credit_card</i>
                        فيزا
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">credit_card</i>
                        ماستر كارد
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">credit_card</i>
                        أمريكان إكسبريس
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">credit_card</i>
                        مدى
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">payments</i>
                        سداد كاش
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">credit_card</i>
                        تابي
                    </div>
                    <div class="payment-method">
                        <i class="material-icons">credit_card</i>
                        تمارا
                    </div>
                </div>
                
                <div class="bank-details">
                    <div class="bank-item">
                        <div class="bank-name">
                            <i class="material-icons">account_balance</i>
                            بنك الراجحي
                        </div>
                        <div class="account-info">
                            <i class="material-icons">account_number</i>
                            رقم الحساب: 409608010911912
                        </div>
                        <div class="account-info">
                            <i class="material-icons">credit_card</i>
                            الآيبان: SA5780000409608010911912
                        </div>
                    </div>
                    
                    <div class="bank-item">
                        <div class="bank-name">
                            <i class="material-icons">account_balance</i>
                            بنك ساب
                        </div>
                        <div class="account-info">
                            <i class="material-icons">account_number</i>
                            رقم الحساب: 262335334001
                        </div>
                        <div class="account-info">
                            <i class="material-icons">credit_card</i>
                            الآيبان: SA7145000000262335334001
                        </div>
                    </div>
                    
                    <div class="bank-item">
                        <div class="bank-name">
                            <i class="material-icons">account_balance</i>
                            البنك الأهلي السعودي
                        </div>
                        <div class="account-info">
                            <i class="material-icons">account_number</i>
                            رقم الحساب: 86100001821204
                        </div>
                        <div class="account-info">
                            <i class="material-icons">credit_card</i>
                            الآيبان: SA9710000086100001821204
                        </div>
                        <div class="beneficiary">
                            <i class="material-icons">person</i>
                            اسم المستفيد: شركة إطلالة للسفر والسياحة شخص واحد
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-divider">
                <img src="https://z-cdn-media.chatglm.cn/files/3f0b9cd4-570e-4ebd-8aff-d14b29404d65_pasted_image_1759242842896.png?auth_key=1790778881-ff8d15077da24bdaa583c77bdfed7461-0-a6a4b77eb709f2fa9cfa5d2fb50cc028" alt="Section Divider">
            </div>

            <div class="section">
                <h3 class="section-title"><i class="material-icons">gavel</i> الشروط والأحكام</h3>
                
                <div class="terms">
                    <div class="terms-item">الحجز غير قابل للإلغاء أو التعديل (المبلغ بالكامل غير مسترد)</div>
                    <div class="terms-item">الشركة غير مسئولة عن تصاريح السفر بكافة أنواعها وتأشيرات الخروج والعودة</div>
                    <div class="terms-item">تاريخ إصدار وانتهاء وثائق السفر بكافة أنواعها تكون مسئولية المسافر</div>
                    <div class="terms-item">قد تتغير الأسعار والإمكانية، يحدد السعر النهائي وفقًا لتاريخ السفر المطلوب</div>
                </div>
            </div>

            <div class="footer">
                شركة اطلاله للسفر والسياحة<br>
                <a href="https://etlaala.com/privacy-policy/">https://etlaala.com/privacy-policy/</a>
            </div>
        </div>
    </div>
</body>
</html>`;
        };
            
            const htmlContent = generateHTML();
            packageDetailsContainer.innerHTML = htmlContent;

            const downloadHTML = () => {
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `عرض-${formData.clientName}-${formData.destination}.html`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            downloadBtn.addEventListener('click', downloadHTML);

        } else {
            packageDetailsContainer.innerHTML = '<p class="p-8">لم يتم العثور على تفاصيل الباقة.</p>';
        }
    </script>
</body>
</html>